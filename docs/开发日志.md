# AINO å¼€å‘æ—¥å¿—

## ğŸ“‹ æ–‡æ¡£è¯´æ˜

æœ¬æ–‡æ¡£è®°å½• AINO å¹³å°çš„å¼€å‘è¿‡ç¨‹ï¼ŒåŒ…æ‹¬ï¼š
- æ¯æ¬¡åŠŸèƒ½å¼€å‘çš„æ€»ç»“
- é‡åˆ°çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ
- æˆåŠŸçš„å¼€å‘æ–¹æ³•
- é¿å…é‡å¤çŠ¯é”™çš„æ£€æŸ¥æ¸…å•

---

## ğŸ¯ å¼€å‘åŸåˆ™

### æ ¸å¿ƒåŸåˆ™
1. **æ•°æ®ä»APIæ¥**ï¼šå‰ç«¯æ°¸è¿œä»APIè·å–æ•°æ®ï¼Œä¸ä½¿ç”¨æœ¬åœ°çŠ¶æ€ç®¡ç†çœŸå®æ•°æ®
2. **æ“ä½œååˆ·æ–°**ï¼šä»»ä½•ä¿®æ”¹æ“ä½œåéƒ½è¦é‡æ–°è·å–æ•°æ®
3. **ä¸€æ¬¡ä¸€ä¸ª**ï¼šæ¯æ¬¡åªå¼€å‘ä¸€ä¸ªåŠŸèƒ½ï¼Œé¿å…åŒæ—¶å¼€å‘å¤šä¸ª
4. **å…ˆæµ‹è¯•åé›†æˆ**ï¼šå…ˆç¡®ä¿APIæ­£å¸¸ï¼Œå†å¯¹æ¥å‰ç«¯
5. **é”™è¯¯è¦å¤„ç†**ï¼šæ‰€æœ‰å¯èƒ½çš„é”™è¯¯éƒ½è¦æœ‰å¤„ç†

### æŠ€æœ¯æ ˆ
- **åç«¯**ï¼šHono + Drizzle ORM + PostgreSQL
- **å‰ç«¯**ï¼šNext.js + React + TypeScript
- **æ•°æ®éªŒè¯**ï¼šZod
- **æ¶æ„æ¨¡å¼**ï¼šä¸‰å±‚æ¶æ„ (Routes â†’ Service â†’ Repository)

---

## ğŸ“ å¼€å‘æ—¥å¿—

### 2025-01-24 - ç›®å½•ç®¡ç†ç³»ç»Ÿ

#### âœ… æˆåŠŸå®Œæˆçš„åŠŸèƒ½
1. **ç›®å½•åˆ›å»º**ï¼šæ”¯æŒæ¨¡æ¿é€‰æ‹©å’Œè‡ªå®šä¹‰ç›®å½•
2. **ç›®å½•æ˜¾ç¤º**ï¼šä»APIè·å–çœŸå®æ•°æ®ï¼Œåˆ·æ–°åå¯è§
3. **ç›®å½•é‡å‘½å**ï¼šå®æ—¶åŒæ­¥åˆ°æ•°æ®åº“
4. **ç›®å½•åˆ é™¤**ï¼šåŒ…å«å®‰å…¨æ£€æŸ¥ï¼Œå®æ—¶åŒæ­¥

#### âŒ é‡åˆ°çš„é—®é¢˜

**é—®é¢˜1ï¼šç›®å½•åˆ›å»ºååˆ·æ–°é¡µé¢æ¶ˆå¤±**
- **åŸå› **ï¼šå‰ç«¯ä½¿ç”¨æœ¬åœ°çŠ¶æ€ç®¡ç†ç›®å½•æ•°æ®ï¼Œåˆ·æ–°åä¸¢å¤±
- **è§£å†³æ–¹æ¡ˆ**ï¼š
  - åœ¨ `useApiBuilderController` ä¸­æ·»åŠ  `fetchDirectories` å‡½æ•°
  - ä»APIè·å–çœŸå®æ•°æ®è€Œä¸æ˜¯æœ¬åœ°çŠ¶æ€
  - æ“ä½œåé‡æ–°è·å–æ•°æ®

**é—®é¢˜2ï¼šç¼ºå°‘ç›®å½•APIæ–¹æ³•**
- **åŸå› **ï¼š`AINO-studio/lib/api.ts` ä¸­æ²¡æœ‰å®šä¹‰ç›®å½•ç›¸å…³çš„APIæ–¹æ³•
- **è§£å†³æ–¹æ¡ˆ**ï¼š
  - æ·»åŠ  `directoriesApi` å¯¹è±¡
  - åŒ…å«å®Œæ•´çš„CRUDæ–¹æ³•ï¼š`getDirectories`, `createDirectory`, `updateDirectory`, `deleteDirectory`

**é—®é¢˜3ï¼šæ•°æ®æµä¸ä¸€è‡´**
- **åŸå› **ï¼šå‰ç«¯hookä¸­çš„ç›®å½•æ•°æ®æ¥æºæ··ä¹±
- **è§£å†³æ–¹æ¡ˆ**ï¼š
  - ç»Ÿä¸€ä½¿ç”¨APIæ•°æ®æº
  - ç§»é™¤æœ¬åœ°çŠ¶æ€ç®¡ç†
  - ç¡®ä¿æ•°æ®æµï¼šAPI â†’ Hook â†’ ç»„ä»¶

#### ğŸ¯ æˆåŠŸçš„å¼€å‘æ–¹æ³•

1. **APIä¼˜å…ˆå¼€å‘**ï¼š
   ```
   åç«¯API â†’ å‰ç«¯APIæ–¹æ³• â†’ Hookå¯¹æ¥ â†’ é¡µé¢æµ‹è¯•
   ```

2. **æ•°æ®æµè®¾è®¡**ï¼š
   ```
   æ•°æ®åº“ â†’ Repository â†’ Service â†’ Routes â†’ API â†’ Hook â†’ ç»„ä»¶
   ```

3. **çŠ¶æ€ç®¡ç†**ï¼š
   ```
   æ“ä½œè§¦å‘ â†’ APIè°ƒç”¨ â†’ é‡æ–°è·å–æ•°æ® â†’ æ›´æ–°çŠ¶æ€ â†’ ç•Œé¢åˆ·æ–°
   ```

#### ğŸ“Š æœ€ç»ˆæ•ˆæœ
- âœ… ç›®å½•åˆ›å»ºåç«‹å³æ˜¾ç¤º
- âœ… åˆ·æ–°é¡µé¢åæ•°æ®ä»ç„¶å­˜åœ¨
- âœ… é‡å‘½åå’Œåˆ é™¤æ“ä½œå®æ—¶åŒæ­¥
- âœ… é”™è¯¯å¤„ç†å®Œå–„ï¼Œç”¨æˆ·å‹å¥½æç¤º

---

## ğŸ”§ å¼€å‘æ£€æŸ¥æ¸…å•

### åç«¯å¼€å‘æ£€æŸ¥
- [ ] DTOæ˜¯å¦ç”¨Zodå®šä¹‰
- [ ] æ˜¯å¦éµå¾ªä¸‰å±‚æ¶æ„ (Routes â†’ Service â†’ Repository)
- [ ] æ˜¯å¦æœ‰æƒé™æ£€æŸ¥
- [ ] æ˜¯å¦æœ‰é”™è¯¯å¤„ç†
- [ ] æ˜¯å¦è¿”å›ç»Ÿä¸€æ ¼å¼ `{success: true, data: ...}`
- [ ] æ•°æ®åº“æ“ä½œæ˜¯å¦æ­£ç¡®
- [ ] æ˜¯å¦æ”¯æŒåˆ†é¡µå’Œè¿‡æ»¤

### å‰ç«¯å¼€å‘æ£€æŸ¥
- [ ] APIæ–¹æ³•æ˜¯å¦åœ¨ `api.ts` ä¸­å®šä¹‰
- [ ] Hookæ˜¯å¦è°ƒç”¨çœŸå®API
- [ ] æ•°æ®æ˜¯å¦ä»APIè·å–ï¼ˆä¸æ˜¯æœ¬åœ°çŠ¶æ€ï¼‰
- [ ] æ“ä½œåæ˜¯å¦é‡æ–°è·å–æ•°æ®
- [ ] æ˜¯å¦æœ‰é”™è¯¯æç¤º
- [ ] åŠ è½½çŠ¶æ€æ˜¯å¦å¤„ç†
- [ ] ç”¨æˆ·æƒé™æ˜¯å¦æ£€æŸ¥

### é›†æˆæµ‹è¯•æ£€æŸ¥
- [ ] å‰ç«¯é¡µé¢æ˜¯å¦æ­£å¸¸æ˜¾ç¤º
- [ ] åˆ›å»º/æ›´æ–°/åˆ é™¤æ˜¯å¦ç”Ÿæ•ˆ
- [ ] åˆ·æ–°é¡µé¢åæ•°æ®æ˜¯å¦è¿˜åœ¨
- [ ] é”™è¯¯æƒ…å†µæ˜¯å¦æœ‰å‹å¥½æç¤º
- [ ] æƒé™æ§åˆ¶æ˜¯å¦ç”Ÿæ•ˆ
- [ ] æ€§èƒ½æ˜¯å¦å¯æ¥å—

---

## ğŸš€ å¼€å‘æ¨¡æ¿

### æ–°åŠŸèƒ½å¼€å‘æµç¨‹
```
1. éœ€æ±‚åˆ†æ â†’ ç¡®å®šæ•°æ®æ¨¡å‹å’ŒAPIæ¥å£
2. åç«¯å¼€å‘ â†’ DTO â†’ Repository â†’ Service â†’ Routes
3. å‰ç«¯å¯¹æ¥ â†’ APIæ–¹æ³• â†’ Hookæ›´æ–° â†’ é¡µé¢æµ‹è¯•
4. éªŒè¯æµ‹è¯• â†’ APIæµ‹è¯• â†’ å‰ç«¯æµ‹è¯• â†’ æŒä¹…åŒ–æµ‹è¯•
```

### APIå¼€å‘æ¨¡æ¿
```typescript
// 1. DTOå®šä¹‰
export const CreateXxxRequest = z.object({
  name: z.string().min(1),
  type: z.enum(['type1', 'type2']),
  config: z.record(z.any()).optional(),
})

export const XxxResponse = z.object({
  id: z.string(),
  name: z.string(),
  type: z.string(),
  createdAt: z.string(),
})

// 2. Repositoryå±‚
export class XxxRepository {
  async create(data: CreateXxxRequest): Promise<XxxResponse> {
    const [result] = await db.insert(xxxTable).values(data).returning()
    return this.convertToResponse(result)
  }
  
  async findMany(query: GetXxxQuery): Promise<XxxListResponse> {
    // å®ç°æŸ¥è¯¢é€»è¾‘
  }
}

// 3. Serviceå±‚
export class XxxService {
  async create(data: CreateXxxRequest, userId: string): Promise<XxxResponse> {
    // æƒé™æ£€æŸ¥
    const hasAccess = await this.checkUserAccess(userId)
    if (!hasAccess) {
      throw new Error("æ²¡æœ‰æƒé™")
    }
    
    // ä¸šåŠ¡é€»è¾‘
    return await this.repo.create(data)
  }
}

// 4. Routeså±‚
app.post("/", zValidator("json", CreateXxxRequest), async (c) => {
  try {
    const data = c.req.valid("json")
    const user = c.get("user")
    const result = await service.create(data, user.id)
    return c.json({ success: true, data: result })
  } catch (error) {
    return c.json({ 
      success: false, 
      error: error instanceof Error ? error.message : "æ“ä½œå¤±è´¥" 
    }, 400)
  }
})
```

### å‰ç«¯APIæ–¹æ³•æ¨¡æ¿
```typescript
// AINO-studio/lib/api.ts
export const xxxApi = {
  async getXxxList(params: {
    applicationId: string
    page?: number
    limit?: number
  }): Promise<ApiResponse<any>> {
    const searchParams = new URLSearchParams()
    Object.entries(params).forEach(([key, value]) => {
      if (value !== undefined) {
        searchParams.append(key, value.toString())
      }
    })
    
    const queryString = searchParams.toString()
    const endpoint = `/api/xxx${queryString ? `?${queryString}` : ''}`
    
    return apiRequest<any>(endpoint)
  },

  async createXxx(data: any, params: any): Promise<ApiResponse<any>> {
    const searchParams = new URLSearchParams()
    Object.entries(params).forEach(([key, value]) => {
      if (value !== undefined) {
        searchParams.append(key, value.toString())
      }
    })
    
    const queryString = searchParams.toString()
    const endpoint = `/api/xxx${queryString ? `?${queryString}` : ''}`
    
    return apiRequest<any>(endpoint, {
      method: 'POST',
      body: JSON.stringify(data),
    })
  },
}
```

---

## ğŸ¯ ä¸‹ä¸€æ­¥å¼€å‘è®¡åˆ’

### å·²å®ŒæˆåŠŸèƒ½
- âœ… ç”¨æˆ·è®¤è¯ç³»ç»Ÿ
- âœ… åº”ç”¨ç®¡ç†
- âœ… æ¨¡å—ç®¡ç†
- âœ… ç›®å½•ç®¡ç†

### å¾…å¼€å‘åŠŸèƒ½
- ğŸ”„ å­—æ®µç®¡ç†ç³»ç»Ÿ
- ğŸ”„ åŠ¨æ€è¡¨ç»“æ„ç”Ÿæˆ
- ğŸ”„ è®°å½•ç®¡ç†
- ğŸ”„ åˆ†ç±»ç®¡ç†
- ğŸ”„ æƒé™ç³»ç»Ÿ
- ğŸ”„ è¿œç¨‹æ¨¡å—æ”¯æŒ

---

## ğŸ“š å‚è€ƒèµ„æ–™

- [äº§å“æ–‡æ¡£](./äº§å“æ–‡æ¡£.md)
- [æŠ€æœ¯æ–‡æ¡£](./æŠ€æœ¯æ–‡æ¡£.md)
- [å¼€å‘çº¦æŸæ–‡æ¡£](./æ¯æ¬¡å¼€å‘å‰éœ€è¦é˜…è¯»çš„çº¦æŸæ–‡æ¡£.md)

---

*æœ€åæ›´æ–°ï¼š2025-01-24*

