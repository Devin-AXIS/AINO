# 无代码通用化业务驱动后端平台 - 完整技术文档

## 文档概览

本文档集为后端开发者提供了完整的实现指南，涵盖从产品需求到技术实现的全方位规范。

### 📋 文档结构

#### 核心概念文档
- **[00-product-overview.md](./00-product-overview.md)** - 产品概览与业务需求
- **[00-technical-architecture.md](./00-technical-architecture.md)** - 技术架构与开发规范

#### 功能实现文档
- **[01-auth-flow.md](./01-auth-flow.md)** - 认证流程与用户管理
- **[02-app-management.md](./02-app-management.md)** - 应用管理系统
- **[03-module-system.md](./03-module-system.md)** - 模块系统架构
- **[04-directory-management.md](./04-directory-management.md)** - 目录管理与数据表结构
- **[05-field-management.md](./05-field-management.md)** - 字段管理系统（核心）
- **[06-record-management.md](./06-record-management.md)** - 记录管理与数据操作
- **[07-permission-system.md](./07-permission-system.md)** - 权限系统与用户管理
- **[08-api-summary-deployment.md](./08-api-summary-deployment.md)** - API汇总与部署配置

#### 前后端集成文档
- **[09-frontend-card-integration.md](./09-frontend-card-integration.md)** - 前端卡片系统集成方案

## 🚀 快速开始

### 环境要求
- Node.js 18+ 
- PostgreSQL 15+
- Docker (可选)

### 本地开发

1. **克隆项目并安装依赖**
```bash
git clone <repository>
cd aios/api
npm install
```

2. **配置环境变量**
```bash
# 创建 .env 文件
PORT=3001
DATABASE_URL=postgresql://postgres:password@localhost:5432/aios
JWT_SECRET=your-secret-key
WEB_ORIGIN=http://localhost:3000
```

3. **启动数据库**
```bash
# 使用 Docker
docker compose up -d db

# 或直接连接现有 PostgreSQL
```

4. **启动开发服务器**
```bash
npm run dev
```

5. **初始化数据**
```bash
npm run seed
```

6. **生成 API 文档**
```bash
npm run openapi:generate
```

### Docker 部署

```bash
# 一键启动完整环境
docker compose up -d --build

# 访问地址
# API: http://localhost:3001
# 文档: http://localhost:3001/docs
# 健康检查: http://localhost:3001/health
```

### 测试

```bash
# 运行冒烟测试
npm run test:smoke

# 类型检查
npx tsc --noEmit
```

## 🎯 产品定位

### 业务驱动的无代码平台
本平台区别于传统的数据驱动无代码平台，采用**业务优先**的设计理念：

- **传统平台**：用户需要理解数据库表、字段、关系等技术概念
- **本平台**：用户通过业务模块、目录、字段的方式直接构建业务系统

### 核心架构层次
```
应用 (Application)
  ↓
模块 (Module) - 业务功能单元
  ↓  
目录 (Directory) - 业务对象集合
  ↓
字段 (Field) - 业务属性
  ↓
关系 (Relation) - 业务关联
```

## 🏗️ 技术架构

### 技术栈选择
- **后端框架**：Fastify（高性能、轻量级）
- **数据库**：PostgreSQL + RLS（行级安全）
- **ORM**：Drizzle ORM（代码即迁移、类型安全）
- **类型系统**：Zod（统一合约、前后端共享）
- **架构模式**：Modular Monolith（模块化单体）

### 设计原则
1. **AI 友好**：为 Cursor 等 AI 开发工具优化的项目结构
2. **现代轻量**：使用最新稳定技术，避免过度工程化
3. **高可扩展**：模块化设计，支持水平扩展
4. **易维护**：清晰的代码结构和完善的类型定义

## 🚀 实现顺序建议
1. **认证系统** - 建立用户体系和权限基础
2. **应用管理** - 实现应用的CRUD和基础配置
3. **模块系统** - 构建模块化架构
4. **目录管理** - 实现业务对象的管理
5. **字段管理** - 核心功能，支持动态字段系统
6. **记录管理** - 实现数据的CRUD操作
7. **权限系统** - 完善细粒度权限控制
8. **前端集成** - 对接动态卡片系统

### 开发规范
- 每个功能模块独立开发，避免相互依赖
- 严格遵循 Zod 合约定义
- 使用 RLS 实现租户隔离
- 完善的错误处理和审计日志

## 📊 核心特性

### 1. 业务驱动建模
- 用户通过业务语言描述需求
- 系统自动生成对应的数据结构
- 支持自然语言到业务模型的转换

### 2. 模块化生态
- 内置核心模块（用户、权限、通知）
- 支持自定义模块开发
- 第三方模块市场集成

### 3. 动态字段系统
- 20+ 种字段类型支持
- 每个目录独立的字段分类
- 字段级权限控制

### 4. 跨模块关系
- 支持复杂的业务关系链
- URN 统一资源命名
- 可视化关系图谱

### 5. AI 增强能力
- 对话式建模
- 智能字段推荐
- 自然语言查询

### 6. 企业模块支持
- 企业级数据隔离
- 企业后台权限管理
- 跨企业数据共享配置

## 🔒 安全与合规

### 多层安全机制
- JWT + RLS 双重鉴权
- 字段级权限控制
- 完整的操作审计
- 数据加密和合规支持

### 租户隔离
- 应用级数据隔离
- 企业模块支持
- 企业后台权限边界

## 🌐 生态扩展

### 模块市场
- 第三方模块发布和安装
- 版本管理和兼容性检查
- 安全审核和签名验证

### 前端集成
- 动态卡片系统
- 业务组合配置
- 实时协作支持

## 📝 开发指南

### 代码组织
```
/api/routes/[module]/
  ├── index.ts          # 路由注册
  ├── get.list.ts       # GET 操作
  ├── post.create.ts    # POST 操作
  ├── put.update.ts     # PUT 操作
  ├── del.remove.ts     # DELETE 操作
  ├── svc.ts           # 业务逻辑
  ├── repo.ts          # 数据访问
  └── dto.ts           # 数据映射
```

### 合约定义
所有 API 输入输出都通过 Zod 定义，确保类型安全和文档自动生成。

### 错误处理
统一的错误码体系（APP_XXXX）和错误响应格式。

## 🎯 实现目标

通过本文档的指导，后端开发者能够：
1. 理解产品的业务逻辑和技术架构
2. 按照规范实现各个功能模块
3. 构建可扩展、高性能的后端系统
4. 支持前端动态卡片系统的数据需求
5. 为未来的 AI 增强和模块生态做好准备

---

**注意**：请按照文档顺序阅读，每个模块的实现都建立在前面模块的基础之上。如有疑问，请参考具体的功能实现文档。
