import type { ModuleModel, FieldModel } from "../store"
import type { FieldCategoryModel } from "../field-categories"
import { DEFAULT_FIELD_CATEGORIES } from "../field-categories"

const uid = () => Math.random().toString(36).slice(2, 10)

function f(
  key: string,
  label: string,
  type: any,
  required = false,
  locked = false,
  extra: Partial<FieldModel> = {},
): FieldModel {
  return {
    id: uid(),
    key,
    label,
    type,
    required,
    locked,
    enabled: true,
    showInList: true,
    showInForm: true,
    showInDetail: true,
    ...extra,
  }
}

export function createUserModule(): ModuleModel {
  return {
    id: uid(),
    name: "用户管理",
    type: "system",
    directories: [
      // 用户管理
      {
        id: uid(),
        name: "用户列表",
        type: "table",
        supportsCategory: false,
        fields: [
          // 基础字段
          f("id", "用户ID", "text", true, true, {
            unique: true,
            locked: true,
          }),
          f("avatar", "头像", "image", false, false, {
            accept: "image/*",
            maxSizeMB: 5,
          }),
          f("name", "姓名", "text", true, false, {
            placeholder: "请输入姓名",
            category: "basic",
          }),
          f("phone", "手机号", "text", false, false, {
            preset: "phone",
            placeholder: "请输入手机号",
            category: "basic",
          }),
          f("email", "邮箱", "text", false, false, {
            preset: "email",
            placeholder: "请输入邮箱",
            category: "basic",
          }),
          f("gender", "性别", "select", false, false, {
            options: ["男", "女", "其他"],
            default: "男",
            category: "basic",
          }),
          f("city", "居住城市", "text", false, false, {
            preset: "city",
            category: "basic",
          }),
          f("birthday", "生日", "date", false, false, {
            dateMode: "single",
            category: "basic",
          }),

          // 特殊字段
          f("qrcode", "二维码", "barcode", false, false, {
            placeholder: "扫码添加",
            category: "special",
          }),
          f("introduction", "个人介绍", "textarea", false, false, {
            placeholder: "请输入个人介绍",
            category: "special",
          }),
          f("signature", "个性签名", "text", false, false, {
            placeholder: "请输入个性签名",
            category: "special",
          }),
          f("title", "职称", "text", false, false, {
            placeholder: "请输入职称",
            category: "special",
          }),
          f("hobbies", "兴趣爱好", "tags", false, false, {
            placeholder: "添加兴趣爱好标签",
            category: "special",
          }),
          f("maritalStatus", "婚姻状况", "select", false, false, {
            options: ["未婚", "已婚", "离异", "丧偶"],
            default: "未婚",
            category: "special",
          }),

          // 经历字段
          f("workExperience", "工作经历", "experience", false, false, {
            desc: "工作经历管理",
            category: "experience",
          }),
          f("education", "教育经历", "experience", false, false, {
            desc: "教育经历管理",
            category: "experience",
          }),
          f("certificates", "荣誉证书", "experience", false, false, {
            desc: "证书和荣誉管理",
            category: "experience",
          }),

          // 业务字段
          f("constellation", "星座", "text", false, false, {
            preset: "constellation",
            placeholder: "请选择星座",
            category: "business",
          }),
          f("skills", "技能", "text", false, false, {
            preset: "skills",
            placeholder: "请选择技能",
            category: "business",
          }),
          f("growthPoints", "成长值", "number", false, false, {
            min: 0,
            default: 0,
            unit: "分",
            category: "business",
          }),
          f("credits", "积分", "number", false, false, {
            min: 0,
            default: 0,
            unit: "分",
            category: "business",
          }),
          f("userLevel", "用户等级", "select", false, false, {
            options: ["青铜", "白银", "黄金", "铂金", "钻石"],
            default: "青铜",
            category: "business",
          }),
          f("membershipType", "会员类型", "select", false, false, {
            options: ["普通用户", "VIP会员", "SVIP会员", "企业会员"],
            default: "普通用户",
            category: "business",
          }),
          f("membershipExpiry", "会员到期时间", "date", false, false, {
            dateMode: "single",
            category: "business",
          }),

          // 系统字段
          f("status", "状态", "select", true, false, {
            options: ["启用", "禁用"],
            default: "启用",
            category: "basic",
          }),
          f("createdAt", "创建时间", "date", false, true, {
            locked: true,
            category: "basic",
          }),
          f("lastLoginAt", "最后登录", "date", false, true, {
            locked: true,
            category: "basic",
          }),
        ],
        records: [
          {
            id: "user_1",
            name: "张三",
            phone: "13800138001",
            email: "zhangsan@example.com",
            gender: "男",
            constellation: "constellation_7", // 天秤座
            skills: ["skill_1", "skill_2", "skill_13"], // Vue, React, 项目管理
            introduction: "资深前端开发工程师，专注于Vue.js和React技术栈",
            signature: "代码改变世界",
            title: "高级前端工程师",
            birthday: "1990-10-15",
            hobbies: ["编程", "阅读", "旅行"],
            city: "北京市",
            maritalStatus: "已婚",
            workExperience: [],
            education: [],
            certificates: [],
            growthPoints: 1250,
            credits: 3500,
            userLevel: "黄金",
            membershipType: "VIP会员",
            status: "启用",
            avatar: "/wise-wizard-library.png",
          },
          {
            id: "user_2",
            name: "李四",
            phone: "13900139002",
            email: "lisi@example.com",
            gender: "女",
            constellation: "constellation_12", // 双鱼座
            skills: ["skill_7", "skill_8"], // UI设计, UX设计
            introduction: "UI/UX设计师，热爱创意设计",
            signature: "设计让生活更美好",
            title: "资深设计师",
            birthday: "1992-03-20",
            hobbies: ["设计", "摄影", "音乐"],
            city: "上海市",
            maritalStatus: "未婚",
            workExperience: [],
            education: [],
            certificates: [],
            growthPoints: 980,
            credits: 2100,
            userLevel: "白银",
            membershipType: "普通用户",
            status: "启用",
            avatar: "/female-adventurer-backpack.png",
          },
          {
            id: "user_3",
            name: "王五",
            phone: "13700137003",
            email: "wangwu@example.com",
            gender: "男",
            constellation: "constellation_5", // 狮子座
            skills: ["skill_13", "skill_14"], // 项目管理, 团队管理
            introduction: "产品经理，专注用户体验优化",
            signature: "用户至上，体验为王",
            title: "产品总监",
            birthday: "1988-08-08",
            hobbies: ["产品", "运动", "电影"],
            city: "深圳市",
            maritalStatus: "已婚",
            workExperience: [],
            education: [],
            certificates: [],
            growthPoints: 1800,
            credits: 5200,
            userLevel: "钻石",
            membershipType: "SVIP会员",
            status: "启用",
            avatar: "/placeholder-i3oqg.png",
          },
        ],
        categories: [],
        fieldCategories: [], // 分层管理不需要字段分类
      },

      // 分层管理
      {
        id: uid(),
        name: "用户分层",
        type: "table",
        supportsCategory: false,
        fields: [
          f("level", "等级名称", "text", true, true, { unique: true }),
          f("minPoints", "最低积分", "number", true, true, { min: 0, step: 1 }),
          f("maxPoints", "最高积分", "number", false, true, { min: 0, step: 1 }),
          f("color", "等级颜色", "text", false, true, { placeholder: "#FF6B6B" }),
          f("icon", "等级图标", "text", false, true, { placeholder: "🥉" }),
          f("benefits", "等级权益", "tags", false, true),
          f("description", "等级描述", "textarea", false, true),
          f("status", "状态", "select", true, true, { options: ["启用", "禁用"], default: "启用" }),
        ],
        records: [
          {
            id: uid(),
            level: "青铜",
            minPoints: 0,
            maxPoints: 999,
            color: "#CD7F32",
            icon: "🥉",
            benefits: ["基础功能", "客服支持"],
            description: "新用户等级，享受基础服务",
            status: "启用",
          },
          {
            id: uid(),
            level: "白银",
            minPoints: 1000,
            maxPoints: 2999,
            color: "#C0C0C0",
            icon: "🥈",
            benefits: ["基础功能", "客服支持", "优先处理"],
            description: "活跃用户等级，享受优先服务",
            status: "启用",
          },
          {
            id: uid(),
            level: "黄金",
            minPoints: 3000,
            maxPoints: 9999,
            color: "#FFD700",
            icon: "🥇",
            benefits: ["基础功能", "客服支持", "优先处理", "专属客服"],
            description: "高级用户等级，享受专属服务",
            status: "启用",
          },
          {
            id: uid(),
            level: "铂金",
            minPoints: 10000,
            maxPoints: 29999,
            color: "#E5E4E2",
            icon: "💎",
            benefits: ["基础功能", "客服支持", "优先处理", "专属客服", "定制服务"],
            description: "VIP用户等级，享受定制服务",
            status: "启用",
          },
          {
            id: uid(),
            level: "钻石",
            minPoints: 30000,
            maxPoints: null,
            color: "#B9F2FF",
            icon: "👑",
            benefits: ["基础功能", "客服支持", "优先处理", "专属客服", "定制服务", "专属顾问"],
            description: "至尊用户等级，享受专属顾问服务",
            status: "启用",
          },
        ],
        categories: [],
      },

      // 会员管理
      {
        id: uid(),
        name: "会员类型",
        type: "table",
        supportsCategory: false,
        fields: [
          f("name", "会员名称", "text", true, true, { unique: true }),
          f("price", "会员价格", "number", true, true, { min: 0, step: 0.01, unit: "¥" }),
          f("duration", "有效期", "number", true, true, { min: 1, step: 1, unit: "天" }),
          f("features", "会员特权", "tags", false, true),
          f("discount", "折扣比例", "percent", false, true, { min: 0, max: 100, default: 100 }),
          f("maxUsers", "最大用户数", "number", false, true, { min: 1, step: 1 }),
          f("description", "会员描述", "textarea", false, true),
          f("popular", "推荐标识", "boolean", false, true, { default: false, trueLabel: "是", falseLabel: "否" }),
          f("status", "状态", "select", true, true, { options: ["启用", "禁用"], default: "启用" }),
        ],
        records: [
          {
            id: uid(),
            name: "普通用户",
            price: 0,
            duration: 365,
            features: ["基础功能", "标准客服"],
            discount: 100,
            maxUsers: null,
            description: "免费用户，享受基础功能",
            popular: false,
            status: "启用",
          },
          {
            id: uid(),
            name: "VIP会员",
            price: 99,
            duration: 30,
            features: ["基础功能", "标准客服", "去广告", "优先支持"],
            discount: 95,
            maxUsers: null,
            description: "月度VIP会员，享受优质服务",
            popular: true,
            status: "启用",
          },
          {
            id: uid(),
            name: "SVIP会员",
            price: 299,
            duration: 90,
            features: ["基础功能", "标准客服", "去广告", "优先支持", "专属客服", "高级功能"],
            discount: 90,
            maxUsers: null,
            description: "季度SVIP会员，享受专属服务",
            popular: false,
            status: "启用",
          },
          {
            id: uid(),
            name: "企业会员",
            price: 999,
            duration: 365,
            features: ["基础功能", "标准客服", "去广告", "优先支持", "专属客服", "高级功能", "团队管理", "数据分析"],
            discount: 85,
            maxUsers: 100,
            description: "年度企业会员，适合团队使用",
            popular: false,
            status: "启用",
          },
        ],
        categories: [],
        fieldCategories: [], // 会员类型不需要字段分类
      },

      // 积分管理
      {
        id: uid(),
        name: "积分规则",
        type: "table",
        supportsCategory: true,
        fields: [
          f("name", "规则名称", "text", true, true, { unique: true }),
          f("action", "触发动作", "select", true, true, {
            options: ["注册", "登录", "签到", "分享", "邀请", "消费", "评价", "完善资料"],
          }),
          f("points", "积分数量", "number", true, true, { step: 1 }),
          f("maxDaily", "每日上限", "number", false, true, { min: 0, step: 1 }),
          f("maxTotal", "总计上限", "number", false, true, { min: 0, step: 1 }),
          f("description", "规则描述", "textarea", false, true),
          f("startDate", "开始时间", "date", false, true, { dateMode: "single" }),
          f("endDate", "结束时间", "date", false, true, { dateMode: "single" }),
          f("status", "状态", "select", true, true, { options: ["启用", "禁用"], default: "启用" }),
        ],
        records: [
          {
            id: uid(),
            name: "新用户注册",
            action: "注册",
            points: 100,
            maxDaily: null,
            maxTotal: 100,
            description: "新用户注册奖励积分",
            startDate: null,
            endDate: null,
            status: "启用",
          },
          {
            id: uid(),
            name: "每日签到",
            action: "签到",
            points: 10,
            maxDaily: 10,
            maxTotal: null,
            description: "每日签到获得积分",
            startDate: null,
            endDate: null,
            status: "启用",
          },
          {
            id: uid(),
            name: "邀请好友",
            action: "邀请",
            points: 50,
            maxDaily: 200,
            maxTotal: null,
            description: "成功邀请好友注册获得积分",
            startDate: null,
            endDate: null,
            status: "启用",
          },
          {
            id: uid(),
            name: "完善资料",
            action: "完善资料",
            points: 20,
            maxDaily: null,
            maxTotal: 20,
            description: "完善个人资料获得积分",
            startDate: null,
            endDate: null,
            status: "启用",
          },
        ],
        categories: [
          {
            id: uid(),
            name: "基础规则",
            children: [],
          },
          {
            id: uid(),
            name: "活动规则",
            children: [],
          },
        ],
        fieldCategories: [], // 积分规则不需要字段分类
      },
    ],
  }
}
